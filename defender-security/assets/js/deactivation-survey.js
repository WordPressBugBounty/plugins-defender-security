function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,_toPropertyKey(a.key),a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(e){var t=function(){return _createClass(function e(){_classCallCheck(this,e),this.reason="not_set",this.requestedAssistance="na",this.modalAction="close",this.modalId="wpdef-deactivation-survey-modal",this.modal=document.getElementById(this.modalId)},[{key:"init",value:function(){this.modal&&this.handleSurveyModal()}},{key:"handleSurveyModal",value:function(){var e=this;this.deactivatePluginLink=document.querySelector('a[id^="deactivate-defender-pro"]')||document.querySelector('a[id^="deactivate-defender-security"]')||document.querySelector('a[id^="deactivate-defender"]'),this.deactivatePluginLink&&this.deactivatePluginLink.addEventListener("click",function(t){t.preventDefault(),e.showModal(),e.handleSurveyForm()})}},{key:"showModal",value:function(){var e;null===(e=window.SUI)||void 0===e||e.openModal(this.modalId,"wpbody-content",void 0,!0,!1,!0)}},{key:"closeModal",value:function(){var e;null===(e=window.SUI)||void 0===e||e.closeModal(!0)}},{key:"handleSurveyForm",value:function(){this.registerRequestAssistanceLinkClickEvent(),this.handleRadioChange(),this.handleSkipDeactivation(),this.handleSubmitForm(),this.handleTrackDeactivate()}},{key:"registerRequestAssistanceLinkClickEvent",value:function(){var e=this,t=this.modal.querySelector("#wpdef-request-assistance-link");t&&(this.requestedAssistance="no",t.addEventListener("click",function(){e.requestedAssistance="yes"}))}},{key:"handleRadioChange",value:function(){var e=this;this.userMessageField=this.modal.querySelector("#wpdef-deactivation-user-message-field"),this.userMessageField&&(this.radios=this.modal.querySelectorAll('input[name="deactivation_reason"]'),0!==this.radios.length&&this.radios.forEach(function(t){t.addEventListener("change",function(){e.reason=this.value,e.toggleUserMessageField(this.parentElement)})}))}},{key:"handleSkipDeactivation",value:function(){var e=this,t=this.modal.querySelector(".wpdef-skip-deactivate-button");t&&t.addEventListener("click",function(t){t.target.classList.add("sui-button-onload"),e.modalAction="skip",e.closeModal(),e.allowToTrack()||e.redirectToDeactivateLink()},{once:!0})}},{key:"handleSubmitForm",value:function(){var e=this,t=this.modal.querySelector(".wpdef-submit-deactivate-button");t&&t.addEventListener("click",function(t){t.target.classList.add("sui-button-onload"),e.modalAction="submit",e.closeModal()},{once:!0})}},{key:"handleTrackDeactivate",value:function(){var e=this;this.modal.addEventListener("afterClose",function(){return e.trackDeactivate()},{once:!0})}},{key:"toggleUserMessageField",value:function(e){var t;if(this.userMessageField){this.userMessageField.remove();var i=null===(t=e.dataset)||void 0===t?void 0:t.placeholder;if(i){var a=this.userMessageField.querySelector("textarea");a.placeholder=i,e.after(this.userMessageField),this.userMessageField.classList.remove("sui-hidden"),a.focus()}}}},{key:"trackDeactivate",value:function(){if(this.shouldTrack()){var t=this.userMessageField.querySelector("textarea").value,i={Reason:this.reason,Message:t,"Modal Action":this.modalAction,"Requested Assistance":this.requestedAssistance,"Tracking Status":this.allowToTrack()?"opted_in":"opted_out"},a=this;e.ajax({url:defender.admin_url,type:"POST",data:{action:"defender_track_deactivate",_ajax_nonce:defender.nonce,properties:i},success:function(e){!0===e.success?a.shouldDeactivatePlugin()&&a.redirectToDeactivateLink():alert(e.data.message)}})}}},{key:"allowToTrack",value:function(){var e;return"undefined"!=typeof defender&&void 0!==(null===(e=defender)||void 0===e?void 0:e.usage_tracking)&&"1"===defender.usage_tracking}},{key:"shouldTrack",value:function(){return this.allowToTrack()||this.isSubmitAction()}},{key:"isSkipAction",value:function(){return"skip"===this.modalAction}},{key:"isSubmitAction",value:function(){return"submit"===this.modalAction}},{key:"shouldDeactivatePlugin",value:function(){return this.isSkipAction()||this.isSubmitAction()}},{key:"redirectToDeactivateLink",value:function(){window.location.href=this.getDeactivateLink()}},{key:"getDeactivateLink",value:function(){return this.deactivatePluginLink.href}}])}();window.WPDEF=window.WPDEF||{},window.WPDEF.DeactivationSurvey=t}(jQuery);
